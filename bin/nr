#!/bin/bash -e

# fzf must be available
if ! command -v fzf >/dev/null 2>&1; then
  echo "[ERROR] fzf is not installed. Please install it (e.g. 'brew install fzf')." >&2
  exit 1
fi

# jq must be available (needed to parse package.json)
if ! command -v jq >/dev/null 2>&1; then
  echo "[ERROR] jq is not installed. Please install it (e.g. 'brew install jq')." >&2
  exit 1
fi

if [[ ! -f package.json ]]; then
  echo "[ERROR] package.json not found." >&2
  exit 1
fi

script=$(jq -r '.scripts | keys[]' package.json | fzf --header="Select an npm script to run:" --prompt="npm script> ")

# User cancelled selection
[[ -z $script ]] && exit 0

echo "npm run $script"
npm run -- "$script"
